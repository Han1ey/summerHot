<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>用户管理</title>
    <headerTemplate th:include="utils/common::headerTemplate"></headerTemplate>
    <script th:inline="javascript" type="text/javascript">
    /*<![CDATA[*/
    function resetPassWord(me, id) {
        $(me).closest("tr").click();
        cleanMask.open();
        $.post(basePath + "user/resetPassWord", {
            id: id
        }, function (json) {
            cleanMask.close();
            if (json.success) {
                $(me).notify("密码成功重置为8个8", {className: "success", position: "right"});
            } else {
                $(me).notify("重置失败[" + json.message + "]", {className: "error", position: "right"});
            }
        }, 'json');
    }

    function start(me, id) {
        $(me).closest("tr").click();
        cleanMask.open();
        $.post(basePath + "user/start", {
            id: id
        }, function (json) {
            cleanMask.close();
            if (json.success) {
                $.notify("开启成功");
                search();
            } else {
                $(me).notify("开启失败[" + json.message + "]", {className: "error", position: "right"});
            }
        }, 'json');
    }

    function stop(me, id) {
        $(me).closest("tr").click();
        cleanMask.open();
        $.post(basePath + "user/stop", {
            id: id
        }, function (json) {
            cleanMask.close();
            if (json.success) {
                $.notify("禁用成功");
                search();
            } else {
                $(me).notify("禁用失败[" + json.message + "]", {className: "error", position: "right"});
            }
        }, 'json');
    }

    function del(me, id) {
        $(me).closest("tr").click();
        if (confirm("确定删除吗？")) {
            cleanMask.open();
            $.post(basePath + "user/del", {
                id: id
            }, function (json) {
                cleanMask.close();
                if (json.success) {
                    $.notify("删除成功");
                    search();
                } else {
                    $(me).notify("删除失败[" + json.message + "]", {className: "error", position: "right"});
                }
            }, 'json');
        }
    }

    var table;

    function search() {
        table.ajax.reload();
    }

    $(function () {
        var paramsFun = function(){
            var params = {};
            params.name = $("#sName").val();
            return params;
        };
        var columns = [{
            data: "id"
        }, {
            data: "userName",
            width: 80
        }, {
            data: "realName",
            width: 60
        }, {
            data: "createTime",
            width: 150
        }, {
            data: "isActivity",
            width: 60
        }, {
            data: null,
            defaultContent: ''
        }];
        var columnDefs = [{
            "visible": false,
            "targets": [1]
        }, {
            "targets": -1,
            render: function (data, type, row) {
                var options = "";
                if (row.isActivity) {
                    options += "<button class='btn btn-default btn-xs' onclick='stop(this, " + row.id + ")'>禁用</button>";
                } else {
                    options += "<button class='btn btn-default btn-xs' onclick='start(this, " + row.id + ")'>启用</button>";
                }
                options += " <button class='btn btn-warning btn-xs' onclick='resetPassWord(this, " + row.id + ")'>重置</button>";
                options += " <button class='btn btn-danger btn-xs' onclick='del(this, " + row.id + ")'>删除</button>";
                return options;
            }
        }, {
            "targets": -2,
            render: function (data, type, row) {
                if (row.isActivity) {
                    return "<span style='color: green;'>有效</span>";
                } else {
                    return "<span style='color: red;'>无效</span>";
                }
            }
        }];
        table = new XDataTables("shTab", basePath + "user/userPageList", paramsFun, columns, columnDefs);
        $("#sName").bind("keypress", function (event) {
            if (event.keyCode == 13) {
                search();
            }
        });
        $("#search").bind("click", function () {
            search();
        });
        $("#addBtn").bind("click", function () {
            $("#userName").val("");
            $("#realName").val("");
            $("#passWord").val("");
            $("#userDialog").dialog("open");
        });
        $("#userDialog").dialog({
            autoOpen: false,
            modal: true,
            width: 340,
            height: 240,
            buttons: [{
                text: "保存",
                click: function () {
                    var userName = $("#userName").val();
                    var realName = $("#realName").val();
                    var passWord = $("#passWord").val();
                    if (!(userName && realName && passWord)) {
                        $.notify("请完善数据后保存");
                        return false;
                    }
                    mask.open();
                    $.post(basePath + "user/saveUser", {
                        userName: userName,
                        realName: realName,
                        passWord: passWord
                    }, function (json) {
                        mask.close();
                        if (json.success) {
                            $.notify("保存成功", {className: "success"});
                            search();
                        } else {
                            $.notify("保存失败", {className: "error"});
                        }
                    }, 'json');
                    $(this).dialog("close");
                }
            }, {
                text: "关闭",
                click: function () {
                    $(this).dialog("close");
                }
            }]
        });
    });
    /*]]>*/
    </script>
</head>
<body>
<div style="margin: 5px;">
    <div id="toolBar" style="margin-bottom: 5px;">
        <div>
            <input id="addBtn" type="button" class="btn btn-info btn-xs" value="新增" />
        </div>
        <div>
            账户名称/真实姓名：<input title="账户名称/真实姓名" id="sName" type="text" />
            <input id="search" class="btn btn-success btn-xs" type="button" value="查询" />
        </div>
    </div>
    <table id="shTab" class="dataTable compact display cell-border hover order-column row-border stripe" cellspacing="0" width="100%">
        <thead>
        <tr>
            <th>序号</th>
            <th>ID</th>
            <th>账户名称</th>
            <th>真实姓名</th>
            <th>创建时间</th>
            <th>是否有效</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <div id="userDialog" title="新增用户" style="display: none">
        <table width="300px;" style="border-collapse: separate; border-spacing: 5px;">
            <tr>
                <td style="text-align: right">账户名称：</td>
                <td><input title="账户名称" id="userName" /></td>
            </tr>
            <tr>
                <td style="text-align: right">真实姓名：</td>
                <td><input title="真实姓名" id="realName" /></td>
            </tr>
            <tr>
                <td style="text-align: right">密码：</td>
                <td><input title="密码" type="password" id="passWord" /></td>
            </tr>
        </table>
    </div>
</div>
</body>
</html>