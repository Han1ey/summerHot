<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>菜单管理</title>
    <headerTemplate th:include="utils/common::headerTemplate"></headerTemplate>
    <script th:inline="javascript" type="text/javascript">
        /*<![CDATA[*/
        var table;

        function search() {
            table.ajax.reload();
        }

        $(function () {
            var paramsFun = function(){
                var params = {};
                params.name = $("#sName").val();
                return params;
            };
            var columns = [{
                data: "id"
            }, {
                data: "menuName",
                width: 80
            }, {
                data: "menuPath",
                width: 80
            }, {
                data: "sort",
                width: 50
            }, {
                data: "isActivity",
                width: 60
            }, {
                data: null,
                defaultContent: ''
            }];
            var columnDefs = [{
                "visible": false,
                "targets": [1]
            }, {
                "targets": -1,
                render: function (data, type, row) {
                    var options = "";
                    return options;
                }
            }, {
                "targets": -2,
                render: function (data, type, row) {
                    if (row.isActivity) {
                        return "<span style='color: green;'>有效</span>";
                    } else {
                        return "<span style='color: red;'>无效</span>";
                    }
                }
            }];
            table = new XDataTables("dtTab", basePath + "role/menu/menuPageList", paramsFun, columns, columnDefs, true, {scrollY: 350});
            $("#sName").bind("keypress", function (event) {
                if (event.keyCode == 13) {
                    search();
                }
            });
            $("#search").bind("click", function () {
                search();
            });
            $("#menuDialog").dialog({
                autoOpen: false,
                modal: true,
                width: 360,
                height: 250,
                buttons: [{
                    text: "保存",
                    click: function () {
                        var menuName = $("#menuName").val();
                        var menuPath = $("#menuPath").val();
                        var sort = $("#sort").val();
                        if (!(menuName && menuPath && sort)) {
                            $.notify("请完善数据后保存");
                            return false;
                        }
                        mask.open();
                        $.post(basePath + "role/menu/saveMenu", {
                            menuName: menuName,
                            menuPath: menuPath,
                            sort: sort
                        }, function (json) {
                            mask.close();
                            if (json.success) {
                                $.notify("保存成功", {className: "success"});
                                search();
                            } else {
                                $.notify("保存失败", {className: "error"});
                            }
                        }, 'json');
                        $(this).dialog("close");
                    }
                }, {
                    text: "关闭",
                    click: function () {
                        $(this).dialog("close");
                    }
                }]
            });
            $("#addBtn").click(function () {
                $("#menuName").val("");
                $("#menuPath").val("");
                $("#sort").val("");
                $("#menuDialog").dialog("open");
            });
        });
        /*]]>*/
    </script>
</head>
<body>
<div style="margin: 5px; display: inline-block; width: 550px;">
    <div id="toolBar" style="margin-bottom: 5px;">
        <div><input id="addBtn" type="button" value="新增" class="btn btn-info btn-xs"/></div>
        <div>
            菜单名称：<input id="sName" />
            <input id="search" class="btn btn-success btn-xs" type="button" value="查询" />
        </div>
    </div>
    <table id="dtTab" class="dataTable compact display cell-border hover order-column row-border stripe" cellspacing="0" width="100%">
        <thead>
        <tr>
            <th>序号</th>
            <th>ID</th>
            <th>菜单名称</th>
            <th>菜单根路径</th>
            <th>排序</th>
            <th>有效</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>
<div id="menuDialog" title="新增菜单" style="display: none">
    <table style="border-collapse: separate; border-spacing: 5px;">
        <tr>
            <td style="text-align: right">菜单名称：</td>
            <td><input title="菜单名称" id="menuName" /></td>
        </tr>
        <tr>
            <td style="text-align: right">菜单根路径：</td>
            <td><input title="菜单根路径" id="menuPath" /></td>
        </tr>
        <tr>
            <td style="text-align: right">排序：</td>
            <td><input title="排序" id="sort" /></td>
        </tr>
    </table>
</div>
</body>
</html>