<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>品牌管理</title>
    <headerTemplate th:include="utils/common::headerTemplate"></headerTemplate>
    <script th:inline="javascript" type="text/javascript">
        /*<![CDATA[*/
        var table;

        function search() {
            table.ajax.reload();
        }

        var paramsFun = function () {
            var params = {};
            params.name = $("#sBrandName").val();
            params.isActivity = $("#sIsActivity").val();
            return params;
        };

        var columns = [{
            data: "id"
        }, {
            data: "brandName",
            width: 120
        }, {
            data: "isActivity",
            width: 60
        }, {
            data: null,
            defaultContent: ''
        }];

        var columnDefs = [{
            "visible": false,
            "targets": [1]
        }, {
            "targets": -1,
            render: function (data, type, row) {
                var options = "";
                options += " <button class='btn btn-info btn-xs' onclick='modify(" + row.id + ", " + JSON.stringify(row.brandName) + ")'>修改</button>";
                if (row.isActivity) {
                    options += " <button class='btn btn-danger btn-xs' onclick='toggle(" + row.id + ")'>禁用</button>";
                } else {
                    options += " <button class='btn btn-success btn-xs' onclick='toggle(" + row.id + ")'>启用</button>";
                }
                return options;
            }
        }, {
            "targets": -2,
            render: function (data, type, row) {
                if (row.isActivity) {
                    return "<span style='color: green;'>有效</span>";
                } else {
                    return "<span style='color: red;'>无效</span>";
                }
            }
        }];

        function toggle(id) {
            cleanMask.open();
            $.post(basePath + "brand/toggle", {
                id: id
            }, function (json) {
                cleanMask.close();
                if (json.success) {
                    $.notify("成功", {className: "success"});
                    search();
                } else {
                    $(me).notify("失败[" + json.message + "]", {className: "error", position: "right"});
                }
            }, 'json');
        }

        function modify(id, brandName) {
            var $brandName = $("#brandName");
            $brandName.val(brandName);
            $("#id").val(id);
            $("#dialog").dialog("open");
            setTimeout(function () {
                $brandName.select()
            }, 100);
        }

        $(function () {
            table = new XDataTables("dtTab", basePath + "brand/brandPageList", paramsFun, columns, columnDefs, true, {scrollY: 390});

            $("#dialog").dialog({
                dialogClass: "no-close",
                closeOnEscape: false,
                draggable: false,
                autoOpen: false,
                modal: true,
                width: 350,
                height: 225,
                resizable: false,
                buttons: [{
                    text: "保存",
                    click: function () {
                        var brandName = $("#brandName").val();
                        var id = $("#id").val();
                        if (!(brandName)) {
                            $.notify("请完善数据后保存");
                            return false;
                        }
                        cleanMask.open();
                        $.post(basePath + "brand/saveBrand", {
                            id: id,
                            brandName: brandName
                        }, function (json) {
                            cleanMask.close();
                            if (json.success) {
                                $.notify("保存成功", {className: "success"});
                                search();
                            } else {
                                $.notify("保存失败[" + json.message + "]", {className: "error"});
                            }
                        }, 'json');
                        $(this).dialog("close");
                    }
                }, {
                    text: "关闭",
                    click: function () {
                        $(this).dialog("close");
                    }
                }]
            });


            $("#sBrandName").bind("keypress", function (event) {
                if (event.keyCode === 13) {
                    search();
                }
            });

            $("#search").bind("click", function () {
                search();
            });

            $("#addBtn").bind("click", function () {
                $("#brandName").val("");
                $("#id").val("");
                $("#dialog").dialog("open");
            });
        });
        /*]]>*/
    </script>
</head>
<body>
<div style="margin: 5px;">
    <div id="toolBar" style="margin-bottom: 5px;">
        <div>
            <input id="addBtn" type="button" class="btn btn-info btn-xs" value="新增"/>
        </div>
        <div>
            <label for="sBrandName">品牌名称：<input type="text" id="sBrandName"/></label>
            <label for="sIsActivity">
                是否有效：
            </label>
            <select id="sIsActivity" style="width: 80px">
                <option value="1">有效</option>
                <option value="0">无效</option>
            </select>
            <input id="search" class="btn btn-success btn-xs" type="button" value="查询"/>
        </div>
    </div>
    <table id="dtTab" class="dataTable compact display cell-border hover order-column row-border stripe" cellspacing="0"
           width="100%">
        <thead>
        <tr>
            <th>序号</th>
            <th>ID</th>
            <th>品牌名称</th>
            <th>有效</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

<div id="dialog" title="新增/修改" style="display: block;">
    <input id="id" type="hidden"/>
    <table width="320px;" style="border-collapse: separate; border-spacing: 5px;">
        <tr>
            <td style="text-align: right">品牌名称：</td>
            <td>
                <input title="品牌名称" id="brandName"/>
                <span style="color: red">*</span>
            </td>
        </tr>
    </table>
</div>
</body>
</html>